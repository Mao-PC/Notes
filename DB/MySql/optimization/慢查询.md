## SQL 排查 - 慢查询日志

> 慢查询日志: MySQL 功能的一种日志功能, 用于记录 MySQL 中响应时间超过阀值的 SQL 语句 (long_query_time, 默认 10 秒)

慢查询日志默认是 **关闭** 的, 建议在开发调优时打开, 而最终部署时关闭

```sql
# 检查是否开启慢查询日志
show variables like '%slow_query_log%';
```

开启慢查询日志

-   临时开启
    ```sql
    # MySQL退出并重启自动停止(在内存中开启)
    set global slow_query_log = 1;
    ```
-   永久开启  
     在 /etc/my.cnf 文件中的 [mysqld] 下追加
    ```properties
    ...
    [mysqld]
    ...
    # 开启慢查询
    slow_query_log = 1
    # 存放日志的文件
    slow_query_log = /var/lib/mysql/localhost-slow.log
    ...
    ```

慢查询阀值 :

```sql
# 查看阀值
show variables like '%long_query_time%';
```

设置阀值 :

-   临时设置
    ```sql
    # 修改后重新登录后生效 MySQL退出并重启自动重置
    set global long_query_time = 1;
    ```
-   永久开启设置
    在 /etc/my.cnf 文件中的 [mysqld] 下追加
    ```properties
    ...
    [mysqld]
    ...
    # 需要重启服务才能生效
    long_query_time = 3
    ...
    ```

---

[MySQL 优化](./README.md)  
[主页](../../../../../)
