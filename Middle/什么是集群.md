[toc]



## 集群



## 什么是集群模式



- 多个主从 (sharding 分片) 模式的组合
- 更大的容量, 更好的性能
- 更高的可用性



## 如何去认真一个集群设计模式



- 集群架构
  1. 组件: 组件功能作用
  2. 管理模式: 中心化, 去中心化 (大多数原则)

- 分片路由
  1. 节点分布 (如redis- cluster 是根据 key 来计算出路径)
  2. 请求路径

- 副本模式 (高可用)
  1. 副本同步模式 redis-cluster 是异步
  2. 副本探活模式 redis-cluster 是通过`ping` `pong`
  3. 副本切换模式 redis-cluster 是大多数原则
- 弹性伸缩
  1. 水平伸缩 (增加节点)
  2. 垂直伸缩 (节点数量不变, 通过替换某个或者某些节点来达到扩容目的)

- 数据一致性
  1. 主从切换一致性 (异步复制会导致在某些时间段主从节点的数据不一致)
  2. 数据迁移一致性 (水平扩容导致的重新分片)
- 性能
  1. QPS 每秒钟处理完请求的次数
  2. RT 即响应时间，处理一次请求所需要的平均处理时间
- 友好度
  1. 协议支持
  2. 接入支持 (有没有现成的客户端, 客户端支持的语音)
  3. 部署维护成本 