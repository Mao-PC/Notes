[toc]

# Hash 算法与碰撞



Hash，一般翻译做散列、杂凑，或音译为哈希，是把任意长度的输入（又叫做预映射pre-image）通过散列算法变换成固定长度的输出，该输出就是散列值。这种转换是一种压缩映射，也就是，散列值的空间通常远小于输入的空间，不同的输入可能会散列成相同的输出，所以不可能从散列值来确定唯一的输入值。简单的说就是一种将任意长度的消息压缩到某一固定长度的消息摘要的函数。



常用的 Hash 算法 `MD4 MD5 SHA`



## Hash 算法用途



1. 文件校验

   常见的 奇偶校验 和 CRC 校验 并没有抗数据篡改的能力, 在一定程度上能检查并就在数据传输中的信号误码, 但不能防止对数据的恶意破坏

   `MD5 Hash` 的 "数字指纹" 特性, 使它成为目前使用最广泛的的一种文件完整性校验和 Checksum 算法, 不少 Unix 系统都提供计算 md5 checksum 命令

2. 数字签名

   Hash 算法也是闲的密码体系中的一个重要组成部分. 由于非对称算法的运算速度较慢, 所以在数字签名协议中, 单项散列函数扮演了一个重要角色. 对 Hash 值又称 "数字摘要" 进行数字签名, 在统计上可以认为对于文件本身进行数字签名是等效的 

3. 鉴权协议

   鉴权协议又被称作跳转--认证模式: 在传输信道是可被侦听, 但不可被篡改的情况下, 这是一种简单而安全的方法



## Hash的特点



1. 从 hash 值不可以反向推导出原始的数据
2. 输入数据的微小变化会得到完全不同的hash值, 相同的数据会得到相同的值
3. 执行效率要高效, 长的文本也能快速计算出hash值
4. hash的冲突概率要小

由于hash的原理是将输入看了那估计的值映射成 hash 空间内, 而 hash 值的空间远小于输入空间. 根据抽屉原理, 一定会存在不同的输入被映射成相同输出的情况. 做为一个好的 hash 算法, 需要这种从头的概率尽可能小



## 常用Hash函数



1. 直接寻址法。取关键字或关键字的某个线性函数值为散列地址。即`H(key)=key或H(key) = a·key + b`，其中a和b为常数（这种散列函数叫做自身函数）
2. 数字分析法。分析一组数据，比如一组员工的出生年月日，这时我们发现出生年月日的前几位数字大体相同，这样的话，出现冲突的几率就会很大，但是我们发现年月日的后几位表示月份和具体日期的数字差别很大，如果用后面的数字来构成散列地址，则冲突的几率会明显降低。因此数字分析法就是找出数字的规律，尽可能利用这些数据来构造冲突几率较低的散列地址。
3. 平方取中法。取关键字平方后的中间几位作为散列地址。
4. 折叠法。将关键字分割成位数相同的几部分，最后一部分位数可以不同，然后取这几部分的叠加和（去除进位）作为散列地址。
5. 随机数法。选择一随机函数，取关键字作为随机函数的种子生成随机值作为散列地址，通常用于关键字长度不同的场合。
6. 除留余数法。取关键字被某个不大于散列表表长m的数p除后所得的余数为散列地址。即 H(key) = key MOD p,p<=m。不仅可以对关键字直接取模，也可在折叠、平方取中等运算之后取模。对p的选择很重要，一般取素数或m，若p选的不好，容易产生碰撞。



## Hash 冲突 (碰撞)



所谓哈希 (Hash), 就是讲不同的输入映射成独一无二的, 固定长度的值 (又称 哈希值)

如果不同的输入得到了同一个哈希值, 就发送了 "哈希碰撞"



**如何防止哈希碰撞 ?**



最有效的方法就是扩大哈希值的取值空间



16个二进制的哈希值, 产生碰撞的可能性是 1/65535 . 也就是说, 如果有 65535 个用户就一点会产生碰撞. 哈希值的长度扩大到 32 个二进制位, 碰撞的可能性就会下降到 1/4294967296



更长的哈希值意味着更大的存储空间, 更多的计算, 将影响性能和初步



**处理冲突的方法**



1. 开放寻址法；Hi=(H(key) + di) MOD m,i=1,2,…，k(k<=m-1)，其中H(key)为散列函数，m为散列表长，di为增量序列，可有下列三种取法：
   - di=1,2,3,…，m-1，称线性探测再散列；
   - di=1^2,-1^2,2^2,-2^2,3^2,…，±k^2,(k<=m/2)称二次探测再散列；
   - di=伪随机数序列，称伪随机探测再散列。
2.  再散列法：Hi=RHi(key),i=1,2,…，k RHi均是不同的散列函数，即在同义词产生地址冲突时计算另一个散列函数地址，直到冲突不再发生，这种方法不易产生“聚集”，但增加了计算时间。
3. 链地址法(拉链法)
4. 建立一个公共溢出区



一般使用 **链地址法** 或者 **开发寻址法**